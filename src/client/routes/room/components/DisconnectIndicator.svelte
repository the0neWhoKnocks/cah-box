<style>
  .disconnect-indicator {
    line-height: 0;
  }
</style>

<script>
  import { onDestroy, onMount } from 'svelte';
  import { DISCONNECT_TIMEOUT } from '../../../../constants';

  let topMaskRef;
  let btmMaskRef;
  let int;

  function stopAnimation() {
    clearInterval(int);
  }

  onMount(() => {
    const updateInterval = 200;
    const interval = DISCONNECT_TIMEOUT / updateInterval;
    let elapsedTime = 0;

    topMaskRef.style.transform = 'scaleY(1)';
    btmMaskRef.style.transform = 'scaleY(0)';

    int = setInterval(() => {
      if(elapsedTime >= DISCONNECT_TIMEOUT) stopAnimation();
      else {
        const perc = elapsedTime/DISCONNECT_TIMEOUT;
        topMaskRef.style.transform = `scaleY(${1 - perc})`
        btmMaskRef.style.transform = `scaleY(${perc})`;
        elapsedTime += interval;
      }
    }, interval);
  });

  onDestroy(() => {
    stopAnimation();
  });
</script>

<div class="disconnect-indicator">
  <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <defs>
      <mask id="mask">
        <rect 
          bind:this={topMaskRef}
          x="162" y="87" width="180" height="160" fill="#fff" style="transform-box: fill-box; transform-origin: center bottom; transform: scaleY(1);"
        ></rect>
        <rect 
          bind:this={btmMaskRef}
          x="162" y="265" width="180" height="160" fill="#fff" style="transform-box: fill-box; transform-origin: center bottom; transform: scaleY(0);"
        ></rect>
      </mask>
    </defs>
    <path id="body" d="M400.85 25.3Q395.3 22 386 22H118q-9.3 0-14.85 3.3Q93 31.35 93 47.65q0 15.7 15.5 21.65 4.85 1.85 10.65 2.45l4.85.3q-1.4 21.15.7 46.2 4.1 50.1 21.25 69.75 7.35 8.45 20.55 17.65 15.25 9.95 22.35 14.85 12.3 8.5 18.05 15.6 7.45 9.25 7.7 19.95-.25 10.65-7.7 19.9-5.75 7.1-18.05 15.6-7.1 4.9-22.35 14.85-13.2 9.2-20.55 17.65-17.15 19.65-21.25 69.75-2.1 25.05-.7 46.2l-4.85.3q-5.8.6-10.65 2.45Q93 448.7 93 464.4q0 16.3 10.15 22.35 5.55 3.3 14.85 3.3h268q9.3 0 14.85-3.3Q411 480.7 411 464.4q0-15.7-15.5-21.65-4.85-1.85-10.65-2.45L380 440q1.4-21.15-.7-46.2-4.1-50.1-21.25-69.75-7.35-8.45-20.55-17.65-15.25-9.95-22.35-14.85-12.3-8.5-18.05-15.6-7.45-9.25-7.7-19.9.25-10.7 7.7-19.95 5.75-7.1 18.05-15.6 7.1-4.9 22.35-14.85 13.2-9.2 20.55-17.65 17.15-19.65 21.25-69.75 2.1-25.05.7-46.2l4.85-.3q5.8-.6 10.65-2.45Q411 63.35 411 47.65q0-16.3-10.15-22.35M357.3 115q-3.55 45.75-17.8 59.7-6.6 6.45-21.15 15.75-17.9 11.5-23.55 15.9-12.75 9.85-19.1 20.4-7.8 12.95-7.65 29.3-.15 16.3 7.65 29.25 6.35 10.55 19.1 20.4 5.65 4.4 23.55 15.9 14.55 9.3 21.15 15.75 14.25 13.95 17.8 59.7 1.8 22.85.7 42.95H146q-1.1-20.1.7-42.95 3.55-45.75 17.8-59.7 6.6-6.45 21.15-15.75 17.9-11.5 23.55-15.9 12.75-9.85 19.1-20.4 7.8-12.95 7.65-29.25.15-16.35-7.65-29.3-6.35-10.55-19.1-20.4-5.65-4.4-23.55-15.9-14.55-9.3-21.15-15.75-14.25-13.95-17.8-59.7-1.8-22.85-.7-42.95h212q1.1 20.1-.7 42.95z"/>
    <path
      id="sand"
      mask="url(#mask)"
      d="M327.45 349.3h-.05q-.0269531-.0466797-.1-.1-5.815039-5.4269531-18.1-13.3.0009766.0166016-.05 0-18.8583984-12.1298828-24.8-16.8-.0953125-.0746094-.2-.15-15.4378906-11.9855469-23.05-24.95v.05q-6.9566406-11.593164-9.1-25.25-2.14375 13.656836-9.15 25.25l.05-.05q-7.613086 12.9644531-23.1 24.95-.0544922.0751953-.15.15-5.9419922 4.6703125-24.85 16.8-.0011719.0167969-.05 0h.05q-12.5863281 8.0654297-18.4 13.55-9.8957031 12.018164-12.75 48.9-1.0011719 12.7904297-1.05 24.65h178.8q-.0492187-11.8597656-1.05-24.65-2.855664-36.8972656-12.8-48.9-.0097656-.0128906-.05-.05l-.05-.05v-.05m12.9-235.6v-.05q1.0007812-12.7398438 1.05-24.6H162.6q.0490234 11.8601563 1.05 24.6v.05q2.8554688 36.8957031 12.75 48.85.0597656.0626953.1.1l.05.05v.05q.0761719.0458984.1.1 5.8640625 5.4263672 18.15 13.25h-.05q.0492187.0333984.05.05 18.9080078 12.1296875 24.85 16.8.0953125.0748047.15.15 15.4871094 11.9851563 23.1 24.9h-.05q7.0060547 11.5927734 9.15 25.25 2.14375-13.6572266 9.1-25.25 7.6355469-12.9544922 23.15-25 .05-.0125.1-.05 5.9416016-4.6701172 24.8-16.8.050586-.0164063.05-.05 12.2832031-7.821875 18.1-13.25.0626953-.0417969.1-.1.0632813-.0417969.1-.1.0470703-.0357422.05-.1 9.944336-11.9519531 12.8-48.85z"
    />
  </svg>
</div>